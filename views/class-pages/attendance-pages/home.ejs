<% layout('./layouts/boilerplate.ejs') %>
<div
  class="d-flex flex-column flex-lg-row justify-content-center justify-content-sm-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom"
>
  <h1 class="h1 text-nowrap">Attendance: <%= singleClass.className %></h1>
  <a
    class="btn btn-outline-primary"
    href="/class/<%= singleClass._id %>/attendance/new"
    >Mark New Attendance</a
  >
</div>

<% if (attendances.length) { %>
<p class="h4 mb-4">
  <strong class="fw-lighter">Average Class Attendance: </strong><%=
  averageClassAttendance %>%
</p>
<% } %> <% var num = 1 %>
<table class="table table-hover">
  <thead class="thead-light">
    <tr>
      <th scope="col" class="px-0"></th>
      <th scope="col">Date</th>
      <th scope="col">Last Updated</th>
      <th scope="col" class="text-center">Percent Present</th>
      <th scope="col" class="text-center">Attendance Options</th>
    </tr>
  </thead>
  <tbody>
    <% for (let attendanceDay of attendances.sort(function(a,b) { return new
    Date(b.date) - new Date(a.date) })) { %>
    <tr>
      <th scope="row" class="text-center ps-0"><%= num++ %>.</th>
      <td><%= moment(attendanceDay.date).format('LL') %></td>
      <td><%= moment(attendanceDay.dateUpdated).format('LL') %></td>
      <td class="text-center"><%= attendanceDay.percentagePresent %>%</td>
      <td class="text-center">
        <a
          href="/class/<%= singleClass._id %>/attendance/<%= attendanceDay._id %>"
          class="btn btn-outline-primary me-1"
        >
          <i class="fas fa-eye"></i>
        </a>
        <a
          href="/class/<%= singleClass._id %>/attendance/<%= attendanceDay._id %>/edit"
          class="btn btn-outline-secondary me-1"
        >
          <i class="fas fa-edit"></i>
        </a>

        <button
          class="btn btn-outline-danger"
          data-bs-toggle="modal"
          data-bs-target="#deleteModal"
        >
          <i class="fas fa-trash-alt"></i>
        </button>

        <form
          class="d-inline"
          action="/class/<%= singleClass._id %>/attendance/<%= attendanceDay._id %>?_method=DELETE"
          method="POST"
        >
          <div
            class="modal fade"
            id="deleteModal"
            tabindex="-1"
            aria-labelledby="deleteModalLabel"
            aria-hidden="true"
          >
            <div class="modal-dialog">
              <div class="modal-content">
                <div class="modal-header">
                  <h5 class="modal-title" id="deleteModalLabel">
                    Delete Attendance
                  </h5>
                  <button
                    type="button"
                    class="btn-close"
                    data-bs-dismiss="modal"
                    aria-label="Close"
                  ></button>
                </div>
                <div class="modal-body text-start">
                  Are you sure you want to delete?
                </div>
                <div class="modal-footer">
                  <button type="submit" class="btn btn-danger">Delete</button>
                </div>
              </div>
            </div>
          </div>
        </form>
      </td>
    </tr>
    <% } %>
  </tbody>
</table>
